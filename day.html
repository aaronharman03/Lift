<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Exercises</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 500px;
    margin: 30px auto;
    padding: 0 15px;
  }
  h1 {
    margin-bottom: 20px;
  }
  #backBtn {
    margin-bottom: 20px;
    background-color: #2d89ef;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
  }
  #exercisesContainer {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
  }
  .exercise-item {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #28a745;
    color: white;
    padding: 12px 15px;
    border-radius: 5px;
    cursor: default;
  }
  .exercise-name {
    flex-grow: 1;
    outline: none;
  }
  .exercise-name[contenteditable="true"] {
    background: white;
    color: black;
    border-radius: 3px;
    padding: 2px 5px;
    cursor: text;
  }
  .menu-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    padding: 0 8px;
  }
  .menu {
    position: absolute;
    top: 40px;
    right: 10px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    display: none;
    z-index: 10;
  }
  .menu.show {
    display: block;
  }
  .menu button {
    background: none;
    border: none;
    padding: 8px 12px;
    width: 100%;
    text-align: left;
    cursor: pointer;
  }
  .menu button:hover {
    background-color: #f0f0f0;
  }
  #addExerciseBtn {
    padding: 10px 15px;
    font-size: 16px;
    background-color: #28a745;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>

<button id="backBtn">&larr; Back to Workouts</button>
<h1 id="workoutTitle"></h1>

<div id="exercisesContainer">
  <!-- Exercises will appear here -->
</div>

<button id="addExerciseBtn">+ add exercise</button>

<script>
  const backBtn = document.getElementById('backBtn');
  const workoutTitle = document.getElementById('workoutTitle');
  const exercisesContainer = document.getElementById('exercisesContainer');
  const addExerciseBtn = document.getElementById('addExerciseBtn');

  backBtn.addEventListener('click', () => {
    window.location.href = 'index.html';
  });

  // Read workout name from query param
  function getQueryParam(param) {
    const params = new URLSearchParams(window.location.search);
    return params.get(param);
  }

  const workoutName = getQueryParam('workout');
  if (workoutName) {
    workoutTitle.textContent = decodeURIComponent(workoutName);
  } else {
    workoutTitle.textContent = 'Unknown Workout';
  }

  // Storage key for exercises per workout
  function getStorageKey(workout) {
    return 'exercises_' + workout;
  }

  // Load exercises from localStorage for this workout
  let exercises = JSON.parse(localStorage.getItem(getStorageKey(workoutName))) || [];

  function saveExercises() {
    localStorage.setItem(getStorageKey(workoutName), JSON.stringify(exercises));
  }

  // Render exercises list
  function renderExercises() {
    exercisesContainer.innerHTML = '';
    exercises.forEach((name, index) => {
      const item = document.createElement('div');
      item.className = 'exercise-item';

      // Exercise name div
      const nameDiv = document.createElement('div');
      nameDiv.className = 'exercise-name';
      nameDiv.textContent = name;

      // 3-dot menu button
      const menuBtn = document.createElement('button');
      menuBtn.className = 'menu-btn';
      menuBtn.textContent = 'â‹®';
      menuBtn.title = 'Options';

      // Create menu container
      const menu = document.createElement('div');
      menu.className = 'menu';

      // Rename button
      const renameBtn = document.createElement('button');
      renameBtn.textContent = 'Rename';
      renameBtn.addEventListener('click', () => {
        menu.classList.remove('show');
        nameDiv.contentEditable = "true";
        nameDiv.focus();
        document.execCommand('selectAll', false, null);
      });

      // Delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.addEventListener('click', () => {
        menu.classList.remove('show');
        if (confirm(`Delete exercise "${nameDiv.textContent}"?`)) {
          exercises.splice(index, 1);
          saveExercises();
          renderExercises();
        }
      });

      menu.appendChild(renameBtn);
      menu.appendChild(deleteBtn);

      menuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        // Close all other menus
        document.querySelectorAll('.menu.show').forEach(m => {
          if (m !== menu) m.classList.remove('show');
        });
        menu.classList.toggle('show');
      });

      document.addEventListener('click', () => {
        menu.classList.remove('show');
      });

      // Rename finish events
      nameDiv.addEventListener('blur', () => {
        if (nameDiv.isContentEditable) {
          nameDiv.contentEditable = "false";
          const newName = nameDiv.textContent.trim();
          if (newName === '') {
            alert('Exercise name cannot be empty');
            nameDiv.textContent = exercises[index];
          } else {
            exercises[index] = newName;
            saveExercises();
            renderExercises();
          }
        }
      });
      nameDiv.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && nameDiv.isContentEditable) {
          e.preventDefault();
          nameDiv.blur();
        }
      });

      item.appendChild(nameDiv);
      item.appendChild(menuBtn);
      item.appendChild(menu);
      exercisesContainer.appendChild(item);
    });
  }

  // Add new exercise
  addExerciseBtn.addEventListener('click', () => {
    exercises.push('New Exercise');
    saveExercises();
    renderExercises();
    setTimeout(() => {
      const lastItem = exercisesContainer.lastChild;
      const nameDiv = lastItem.querySelector('.exercise-name');
      nameDiv.contentEditable = "true";
      nameDiv.focus();
      document.execCommand('selectAll', false, null);
    }, 0);
  });

  renderExercises();
</script>

</body>
</html>
