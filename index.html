<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fitness App - Days</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
  #days-container { margin-bottom: 20px; }
  .day-button {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #007bff;
    color: white;
    padding: 10px;
    margin: 6px 0;
    border-radius: 4px;
    cursor: pointer;
  }
  .day-name {
    flex-grow: 1;
    outline: none;
    border: none;
    background: transparent;
    color: white;
    font-size: 1rem;
    user-select: none;
  }
  .day-name[contenteditable="true"] {
    border-bottom: 1px solid white;
    user-select: text;
  }
  .menu-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    position: relative;
  }
  .menu-dropdown {
    position: absolute;
    top: 28px;
    right: 0;
    background: white;
    color: black;
    border: 1px solid #ccc;
    border-radius: 4px;
    display: none;
    flex-direction: column;
    min-width: 80px;
    z-index: 10;
  }
  .menu-dropdown.show {
    display: flex;
  }
  .menu-dropdown button {
    background: none;
    border: none;
    padding: 8px;
    text-align: left;
    cursor: pointer;
  }
  #add-day-btn {
    padding: 10px;
    font-size: 1rem;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>My Workout Days</h1>

<div id="days-container"></div>

<button id="add-day-btn">+ Add Day</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    query,
    orderBy,
    addDoc,
    doc,
    updateDoc,
    deleteDoc,
    onSnapshot,
  } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    signOut,
  } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

  // TODO: Replace with your Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "yourproject.firebaseapp.com",
    projectId: "yourproject-id",
    storageBucket: "yourproject.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const daysContainer = document.getElementById("days-container");
  const addDayBtn = document.getElementById("add-day-btn");

  let currentUser = null;

  // Create a day element
  function createDayElement(dayDoc) {
    const dayData = dayDoc.data();

    const dayEl = document.createElement("div");
    dayEl.className = "day-button";

    const dayName = document.createElement("div");
    dayName.className = "day-name";
    dayName.textContent = dayData.name || "Unnamed Day";
    dayName.contentEditable = false;

    // Navigate to workouts page when day name clicked (only if not editing)
    dayName.addEventListener("click", () => {
      if (!dayName.isContentEditable) {
        window.location.href = `workouts.html?dayId=${dayDoc.id}`;
      }
    });

    // 3-dot menu button
    const menuBtn = document.createElement("button");
    menuBtn.className = "menu-btn";
    menuBtn.textContent = "â‹®";

    // Dropdown menu
    const menuDropdown = document.createElement("div");
    menuDropdown.className = "menu-dropdown";

    const renameBtn = document.createElement("button");
    renameBtn.textContent = "Rename";

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";

    menuDropdown.appendChild(renameBtn);
    menuDropdown.appendChild(deleteBtn);
    menuBtn.appendChild(menuDropdown);

    // Toggle dropdown
    menuBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      // Close any other open menus
      document.querySelectorAll(".menu-dropdown.show").forEach(menu => {
        if (menu !== menuDropdown) menu.classList.remove("show");
      });
      menuDropdown.classList.toggle("show");
    });

    // Rename handler
    renameBtn.addEventListener("click", () => {
      menuDropdown.classList.remove("show");
      dayName.contentEditable = true;
      dayName.focus();

      // Place cursor at end
      document.execCommand("selectAll", false, null);
      document.getSelection().collapseToEnd();

      // Save on Enter or blur
      function saveName() {
        dayName.contentEditable = false;
        const newName = dayName.textContent.trim() || "Unnamed Day";
        updateDoc(doc(db, "users", currentUser.uid, "days", dayDoc.id), {
          name: newName,
        });
        dayName.removeEventListener("blur", saveName);
        dayName.removeEventListener("keydown", onKeyDown);
      }
      function onKeyDown(e) {
        if (e.key === "Enter") {
          e.preventDefault();
          dayName.blur();
        }
      }
      dayName.addEventListener("blur", saveName);
      dayName.addEventListener("keydown", onKeyDown);
    });

    // Delete handler
    deleteBtn.addEventListener("click", async () => {
      menuDropdown.classList.remove("show");
      if (confirm(`Delete day "${dayData.name}"?`)) {
        await deleteDoc(doc(db, "users", currentUser.uid, "days", dayDoc.id));
      }
    });

    dayEl.appendChild(dayName);
    dayEl.appendChild(menuBtn);

    // Close menus if clicking outside
    document.addEventListener("click", () => {
      menuDropdown.classList.remove("show");
    });

    return dayEl;
  }

  // Load and listen for days from Firestore
  function loadDays() {
    const daysRef = collection(db, "users", currentUser.uid, "days");
    const q = query(daysRef, orderBy("createdAt"));
    onSnapshot(q, (snapshot) => {
      daysContainer.innerHTML = "";
      snapshot.forEach((doc) => {
        daysContainer.appendChild(createDayElement(doc));
      });
    });
  }

  // Add new day and auto-trigger rename
  async function addNewDay() {
    if (!currentUser) return alert("Not logged in");

    const newDayRef = await addDoc(collection(db, "users", currentUser.uid, "days"), {
      name: "New Day",
      createdAt: new Date(),
    });

    // Wait a tick, then find new day element and auto-rename
    setTimeout(() => {
      const dayElements = daysContainer.querySelectorAll(".day-button");
      for (const dayEl of dayElements) {
        const dayNameEl = dayEl.querySelector(".day-name");
        if (dayNameEl.textContent === "New Day") {
          // Simulate clicking rename
          dayNameEl.dispatchEvent(new Event('click'));
          const menuBtn = dayEl.querySelector(".menu-btn");
          menuBtn.click(); // Open menu
          const renameBtn = dayEl.querySelector(".menu-dropdown button:first-child");
          renameBtn.click();
          break;
        }
      }
    }, 500);
  }

  addDayBtn.addEventListener("click", addNewDay);

  // Authentication handling (simple auto-login for demo)
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      loadDays();
    } else {
      // For demo only: sign in with fixed credentials
      signInWithEmailAndPassword(auth, "test@example.com", "test123").catch(console.error);
    }
  });
</script>

</body>
</html>







