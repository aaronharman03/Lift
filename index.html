<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lift Tracker</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .day { margin-bottom: 30px; }
  .task { border: 1px solid #ccc; padding: 10px; margin: 5px 0; cursor: pointer; }
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: flex; align-items: center; justify-content: center;
  }
  .modal {
    background: white; padding: 20px; width: 600px; max-width: 90%;
    max-height: 80vh; overflow-y: auto; border-radius: 8px; box-shadow: 0 0 10px #00000044;
  }
  .exercise {
    border-bottom: 1px solid #ddd; padding: 10px 0;
  }
  .exercise input[type="text"],
  .exercise input[type="number"] {
    margin-right: 10px; width: 120px;
  }
  .sets-container {
    margin-top: 8px;
  }
  .progress-bar {
    height: 15px;
    background-color: #eee;
    border-radius: 8px;
    overflow: hidden;
    margin: 4px 0;
  }
  .progress-bar-fill {
    height: 100%;
    background-color: #4caf50;
    width: 0%;
    transition: width 0.3s ease;
  }
  button {
    margin-top: 10px;
  }
  .add-exercise-btn {
    margin: 10px 0 20px 0;
  }
  .close-btn {
    float: right;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
    border: none;
    background: transparent;
  }
</style>
</head>
<body>

<h1>Weekly Tasks</h1>
<div id="tasks-container"></div>

<!-- Lift Tracker Modal -->
<div id="lift-modal" class="modal-overlay" style="display:none;">
  <div class="modal">
    <button class="close-btn" id="close-lift-modal">&times;</button>
    <h2>Lift Tracker</h2>
    <div id="exercises-list"></div>
    <button id="add-exercise" class="add-exercise-btn">+ Add Exercise</button>
    <button id="done-lift">Done</button>
  </div>
</div>

<script>
  // Data: Weekly tasks (7 days, each with an array of tasks)
  // Only one Lift task for demo, could be expanded.
  let tasks = [
    [ {name: "Lift", desc: ""}, {name: "Run", desc: "5km easy"} ],
    [ {name: "Lift", desc: ""}, {name: "Swim", desc: "30 mins"} ],
    [ {name: "Lift", desc: ""} ],
    [ {name: "Lift", desc: ""} ],
    [ {name: "Lift", desc: ""} ],
    [ {name: "Lift", desc: ""} ],
    [ {name: "Lift", desc: ""} ]
  ];

  // Load from localStorage or initialize empty lift exercises list
  let liftExercises = JSON.parse(localStorage.getItem('liftExercises')) || [];

  const tasksContainer = document.getElementById('tasks-container');
  const liftModal = document.getElementById('lift-modal');
  const closeLiftModalBtn = document.getElementById('close-lift-modal');
  const exercisesListDiv = document.getElementById('exercises-list');
  const addExerciseBtn = document.getElementById('add-exercise');
  const doneLiftBtn = document.getElementById('done-lift');

  // Render all days and tasks (daily view)
  function render() {
    tasksContainer.innerHTML = '';
    tasks.forEach((dayTasks, dayIndex) => {
      const dayDiv = document.createElement('div');
      dayDiv.className = 'day';
      dayDiv.innerHTML = `<h3>Day ${dayIndex + 1}</h3>`;

      dayTasks.forEach(task => {
        const taskDiv = document.createElement('div');
        taskDiv.className = 'task';
        taskDiv.textContent = task.name;

        // Show task description summary for Lift only, no exercises inline
        if (task.name === 'Lift' && task.desc) {
          const descDiv = document.createElement('div');
          descDiv.style.fontSize = '0.9em';
          descDiv.style.color = '#555';
          descDiv.style.marginTop = '5px';
          descDiv.textContent = task.desc;
          taskDiv.appendChild(descDiv);
        } else if (task.desc) {
          // For other tasks, show description normally
          const descDiv = document.createElement('div');
          descDiv.style.fontSize = '0.9em';
          descDiv.style.color = '#555';
          descDiv.style.marginTop = '5px';
          descDiv.textContent = task.desc;
          taskDiv.appendChild(descDiv);
        }

        // Open Lift Tracker modal on Lift task click
        if (task.name === 'Lift') {
          taskDiv.style.fontWeight = 'bold';
          taskDiv.addEventListener('click', () => {
            openLiftModal();
          });
        }

        dayDiv.appendChild(taskDiv);
      });

      tasksContainer.appendChild(dayDiv);
    });
  }

  // Render exercises inside the modal with editable inputs and progress bars
  function renderExercises() {
    exercisesListDiv.innerHTML = '';

    if (liftExercises.length === 0) {
      exercisesListDiv.innerHTML = '<p>No exercises yet. Add one!</p>';
      return;
    }

    liftExercises.forEach((ex, idx) => {
      const exDiv = document.createElement('div');
      exDiv.className = 'exercise';

      // Exercise name input
      const nameInput = document.createElement('input');
      nameInput.type = 'text';
      nameInput.placeholder = 'Exercise name';
      nameInput.value = ex.name;
      nameInput.addEventListener('input', e => {
        liftExercises[idx].name = e.target.value;
      });

      // Weight input
      const weightInput = document.createElement('input');
      weightInput.type = 'number';
      weightInput.min = 0;
      weightInput.placeholder = 'Weight';
      weightInput.value = ex.weight || '';
      weightInput.addEventListener('input', e => {
        liftExercises[idx].weight = Number(e.target.value);
        renderExercises(); // re-render progress bars when weight changes
      });

      // Remove exercise button
      const removeBtn = document.createElement('button');
      removeBtn.textContent = 'Remove';
      removeBtn.style.marginLeft = '10px';
      removeBtn.addEventListener('click', () => {
        liftExercises.splice(idx, 1);
        renderExercises();
      });

      exDiv.appendChild(nameInput);
      exDiv.appendChild(weightInput);
      exDiv.appendChild(removeBtn);

      // Sets inputs and progress bars container
      const setsContainer = document.createElement('div');
      setsContainer.className = 'sets-container';

      // Create 5 sets inputs and progress bars
      ex.sets = ex.sets || [0,0,0,0,0]; // default 5 sets, 0 reps

      for (let i = 0; i < 5; i++) {
        const setInput = document.createElement('input');
        setInput.type = 'number';
        setInput.min = 0;
        setInput.placeholder = `Set ${i+1} reps`;
        setInput.style.width = '70px';
        setInput.value = ex.sets[i];
        setInput.addEventListener('input', e => {
          let val = parseInt(e.target.value);
          if (isNaN(val) || val < 0) val = 0;
          liftExercises[idx].sets[i] = val;
          renderExercises(); // update progress bars live
        });

        // Progress bar showing % of max reps for the set (max 12 reps for scaling)
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';

        const fill = document.createElement('div');
        fill.className = 'progress-bar-fill';

        // Calculate fill % capped at 100% for reps over 12
        let fillPercent = Math.min((liftExercises[idx].sets[i] / 12) * 100, 100);
        fill.style.width = fillPercent + '%';

        progressBar.appendChild(fill);

        // Wrap input and progress bar in a container
        const setWrapper = document.createElement('div');
        setWrapper.style.display = 'flex';
        setWrapper.style.alignItems = 'center';
        setWrapper.style.marginBottom = '6px';
        setWrapper.style.gap = '8px';

        setWrapper.appendChild(setInput);
        setWrapper.appendChild(progressBar);

        setsContainer.appendChild(setWrapper);
      }

      exDiv.appendChild(setsContainer);

      exercisesListDiv.appendChild(exDiv);
    });
  }

  // Open the Lift Tracker modal
  function openLiftModal() {
    renderExercises();
    liftModal.style.display = 'flex';
  }

  // Close the Lift Tracker modal
  function closeLiftModal() {
    liftModal.style.display = 'none';
  }

  // Update the Lift task description with a clean summary and save data
  function updateLiftTaskDescription() {
    // Compose a summary like: "Squat - 100 lbs - 5,5,5,5,5; Bench - 80 lbs - 5,5,5,5,5"
    const summaries = liftExercises
      .filter(ex => ex.name.trim())
      .map(ex => {
        const weight = ex.weight || 0;
        const setsStr = ex.sets ? ex.sets.join(',') : '';
        return `${ex.name.trim()} - ${weight} lbs - ${setsStr}`;
      });
    const summaryText = summaries.join('; ');

    // Update every Lift task desc in all days
    tasks.forEach(dayTasks => {
      dayTasks.forEach(task => {
        if (task.name === 'Lift') {
          task.desc = summaryText;
        }
      });
    });

    saveTasks();
    render();
  }

  // Save liftExercises to localStorage
  function saveLiftExercises() {
    localStorage.setItem('liftExercises', JSON.stringify(liftExercises));
  }

  // Save tasks to localStorage as well (optional but keeps data)
  function saveTasks() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
  }

  // Load tasks from localStorage if available
  function loadTasks() {
    const savedTasks = localStorage.getItem('tasks');
    if (savedTasks) {
      tasks = JSON.parse(savedTasks);
    }
  }

  // Initialize app
  function init() {
    loadTasks();
    render();

    // Add exercise button
    addExerciseBtn.addEventListener('click', () => {
      liftExercises.push({name: '', weight: 0, sets: [0,0,0,0,0]});
      renderExercises();
    });

    // Done button saves and closes modal
    doneLiftBtn.addEventListener('click', () => {
      // Clean exercises: remove empty names
      liftExercises = liftExercises.filter(ex => ex.name.trim());
      saveLiftExercises();
      updateLiftTaskDescription();
      closeLiftModal();
    });

    closeLiftModalBtn.addEventListener('click', () => {
      closeLiftModal();
    });
  }

  init();
</script>

</body>
</html>


