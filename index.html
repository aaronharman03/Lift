<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workout Days</title>
<style>
  body {
    font-family: sans-serif;
    max-width: 500px;
    margin: 40px auto;
    padding: 0 16px;
    background: #f9f9f9;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  .day-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: white;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 12px 14px;
    margin-bottom: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  .day-label {
    font-size: 16px;
    flex-grow: 1;
    text-decoration: none;
    color: black;
    word-break: break-word;
  }
  .day-label[contenteditable="true"] {
    background: #eef5ff;
    outline: none;
    padding: 2px 4px;
    border-radius: 4px;
  }
  .menu-btn {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    padding: 4px;
    margin-left: 8px;
  }
  .menu {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 4px 0;
    z-index: 10;
    min-width: 120px;
  }
  .menu button {
    display: block;
    width: 100%;
    padding: 8px 10px;
    background: none;
    border: none;
    text-align: left;
    font-size: 14px;
    cursor: pointer;
  }
  .menu button:hover {
    background: #f0f0f0;
  }
  #addDayBtn {
    display: block;
    width: 100%;
    margin-top: 20px;
    padding: 12px;
    font-size: 16px;
    border-radius: 8px;
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
  }
  #addDayBtn:hover {
    background-color: #0056b3;
  }
</style>
</head>
<body>
<h1>Workout Days</h1>
<div id="daysList"></div>
<button id="addDayBtn">+ Add Day</button>

<!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<!-- Firebase Firestore SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // TODO: Replace with your own Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const daysList = document.getElementById('daysList');
  const addDayBtn = document.getElementById('addDayBtn');
  let openMenu = null;

  let days = []; // will hold data from Firestore

  // Fetch days from Firestore
  async function fetchDays() {
    try {
      const snapshot = await db.collection('workout_days').orderBy('id').get();
      if (snapshot.empty) {
        // Initialize default days if none exist
        days = [
          { id: 1, name: 'Day 1' },
          { id: 2, name: 'Day 2' },
          { id: 3, name: 'Day 3' },
        ];
        // Save them to Firestore
        await Promise.all(days.map(day => 
          db.collection('workout_days').doc(day.id.toString()).set(day)
        ));
      } else {
        days = snapshot.docs.map(doc => doc.data());
      }
      renderDays();
    } catch (error) {
      alert('Failed to load days from Firestore: ' + error.message);
    }
  }

  // Save all days to Firestore (overwrite existing)
  async function saveDays() {
    try {
      const batch = db.batch();
      const collectionRef = db.collection('workout_days');
      days.forEach(day => {
        const docRef = collectionRef.doc(day.id.toString());
        batch.set(docRef, day);
      });
      await batch.commit();
    } catch (error) {
      alert('Failed to save days to Firestore: ' + error.message);
    }
  }

  function renderDays() {
    daysList.innerHTML = '';
    days.forEach((day, index) => {
      const row = document.createElement('div');
      row.className = 'day-row';

      const label = document.createElement('a');
      label.className = 'day-label';
      label.textContent = day.name;
      label.href = `day.html?day=${day.id}`;

      const menuBtn = document.createElement('button');
      menuBtn.className = 'menu-btn';
      menuBtn.innerHTML = 'â‹®';

      const menu = document.createElement('div');
      menu.className = 'menu';
      menu.style.display = 'none';

      const rename = document.createElement('button');
      rename.textContent = 'Rename';
      rename.onclick = () => {
        label.contentEditable = true;
        label.focus();
        closeMenu();
      };

      const del = document.createElement('button');
      del.textContent = 'Delete';
      del.onclick = async () => {
        if (confirm(`Delete "${day.name}"?`)) {
          days.splice(index, 1);
          await saveDays();
          renderDays();
        }
      };

      menu.appendChild(rename);
      menu.appendChild(del);
      document.body.appendChild(menu);

      menuBtn.onclick = (e) => {
        e.stopPropagation();
        toggleMenu(menu, menuBtn);
      };

      label.addEventListener('blur', async () => {
        label.contentEditable = false;
        const newName = label.textContent.trim();
        if (newName) {
          day.name = newName;
          await saveDays();
        } else {
          label.textContent = day.name;
        }
      });

      label.addEventListener('keydown', async e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          label.blur();
        }
      });

      row.appendChild(label);
      row.appendChild(menuBtn);
      daysList.appendChild(row);
    });
  }

  function toggleMenu(menu, btn) {
    closeMenu();
    const rect = btn.getBoundingClientRect();
    const scrollY = window.scrollY || document.documentElement.scrollTop;
    const scrollX = window.scrollX || document.documentElement.scrollLeft;

    menu.style.top = (rect.bottom + scrollY + 4) + 'px';
    menu.style.left = (Math.min(rect.left + scrollX, window.innerWidth - 140)) + 'px';
    menu.style.display = 'block';
    openMenu = menu;
  }

  function closeMenu() {
    if (openMenu) openMenu.style.display = 'none';
    openMenu = null;
  }

  addDayBtn.onclick = async () => {
    const nextId = days.length ? Math.max(...days.map(d => d.id)) + 1 : 1;
    days.push({ id: nextId, name: `Day ${nextId}` });
    await saveDays();
    renderDays();
  };

  window.addEventListener('click', closeMenu);

  // Load days from Firestore on page load
  fetchDays();

</script>
</body>
</html>



