<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Physique & Daily Tracker</title>
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4caf50">

<!-- iOS support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="PhysiqueTracker">
<link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    input, select, button { width: 100%; padding: 10px; margin-top: 10px; }
    .result { margin-top: 20px; }
    #dailyTracker { display: none; }
    .date-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
    button.nav-btn { width: auto; padding: 0.5rem 1rem; margin: 0 0.5rem; }
    input[type="date"], input[type="number"], input[type="text"] { padding: 0.5rem; width: auto; }
    .log { border-top: 1px solid #ccc; padding-top: 1rem; }
    .progress-container { margin-top: 20px; }
    .progress-labels { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 4px; }
    .progress-bar { width: 100%; height: 20px; background-color: #eee; border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; background-color: #4caf50; width: 50%; }
    .nutrient-stats { margin-top: 10px; font-size: 0.9rem; }
    .nutrient-stats div { margin: 4px 0; }
    .activity-log, .food-log { margin-top: 20px; }
    .activity-log select, .activity-log input, .food-log input { padding: 0.5rem; margin: 0.5rem 0.5rem 0.5rem 0; }
    .activity-log ul, .food-log ul { list-style-type: none; padding: 0; }
    .activity-log li, .food-log li { padding: 4px 0; }
    .meals { margin-top: 20px; }
    .meal { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; min-height: 50px; background-color: #f9f9f9; }
    .meal h4 { margin: 0 0 5px; }
  </style>
</head>
<body>

  <!-- Physique & Baseline Stats -->
  <div id="physiqueForm">
    <h1>Physique & Baseline Stats</h1>

    <select id="gender">
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>

    <input type="number" id="age" placeholder="Age" />

    <select id="unitSystem">
      <option value="imperial">Imperial (lbs, inches)</option>
      <option value="metric">Metric (kg, cm)</option>
    </select>

    <input type="number" id="height" placeholder="Height (inches or cm)" />
    <input type="number" id="weight" placeholder="Weight (lbs or kg)" />
    <input type="number" id="bodyFat" placeholder="Current Body Fat %" />

    <select id="goal">
      <option value="Lose Fat">Lose Fat</option>
      <option value="Build Muscle">Build Muscle</option>
      <option value="Recomposition">Recomposition</option>
    </select>

    <button onclick="calculateAndContinue()">Calculate & Continue</button>

    <div class="result" id="results"></div>
  </div>

  <!-- Daily Tracker -->
  <div id="dailyTracker">
    <h1>Daily Tracker</h1>

    <div class="date-nav">
      <button class="nav-btn" onclick="changeDate(-1)">&larr;</button>
      <input type="date" id="datePicker" onchange="loadLog()" />
      <button class="nav-btn" onclick="changeDate(1)">&rarr;</button>
    </div>

    <div class="log" id="dailyLog">
      <p>Loading data...</p>
    </div>

    <div class="progress-container">
      <div class="progress-labels">
        <span>Current</span>
        <span>Goal</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="nutrient-stats">
        <div><strong>Calories:</strong> <span id="kcalStat">0 / 0 kcal (0%)</span></div>
        <div><strong>Protein:</strong> <span id="proteinStat">0g / 160g (0%)</span></div>
      </div>
    </div>

    <div class="activity-log">
      <h3>Log Activity</h3>
      <select id="activityType">
        <option value="run">Run</option>
        <option value="lift">Lift</option>
        <option value="walk">Walk</option>
        <option value="stand">Stand</option>
      </select>
      <input type="number" id="activityDuration" placeholder="Duration (min)" min="1" />
      <button onclick="addActivity()">Add Activity</button>

      <ul id="activityList"></ul>
    </div>

    <div class="food-log">
      <h3>Log Food</h3>
      <input type="text" id="foodSearch" placeholder="Search food..." />
      <input type="number" id="foodQuantity" placeholder="Quantity (g/ml/etc)" min="1" />
      <button onclick="addFood()">Add Food</button>

      <ul id="foodList"></ul>
    </div>

    <div class="meals">
      <h3>Meals</h3>
      <div class="meal" id="breakfast" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Breakfast</h4>
      </div>
      <div class="meal" id="lunch" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Lunch</h4>
      </div>
      <div class="meal" id="dinner" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Dinner</h4>
      </div>
      <div class="meal" id="snack" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Snack</h4>
      </div>
    </div>
  </div>

  <script>
    // Physique form & Daily tracker elements
    const physiqueForm = document.getElementById('physiqueForm');
    const dailyTracker = document.getElementById('dailyTracker');
    const resultsDiv = document.getElementById('results');

    // Daily tracker elements
    const datePicker = document.getElementById("datePicker");
    const logContainer = document.getElementById("dailyLog");
    const progressFill = document.getElementById("progressFill");
    const kcalStat = document.getElementById("kcalStat");
    const proteinStat = document.getElementById("proteinStat");
    const activityList = document.getElementById("activityList");
    const foodList = document.getElementById("foodList");

    // Variables for calorie goal & current calories (mocked)
    let calorieGoal = 2400; // Default, overwritten on calculation
    let kcalConsumed = 0; // Starts at zero
    let proteinGoal = 160; // Keep protein goal static here
    let proteinConsumed = 0;

    function calculateAndContinue() {
      const gender = document.getElementById('gender').value;
      const age = parseInt(document.getElementById('age').value);
      const unitSystem = document.getElementById('unitSystem').value;
      const heightInput = parseFloat(document.getElementById('height').value);
      const weightInput = parseFloat(document.getElementById('weight').value);
      const bodyFatInput = parseFloat(document.getElementById('bodyFat').value);
      const goal = document.getElementById('goal').value;

      if (isNaN(age) || isNaN(heightInput) || isNaN(weightInput) || isNaN(bodyFatInput)) {
        resultsDiv.innerHTML = '<p style="color:red;">Please fill all fields with valid numbers.</p>';
        return;
      }

      const bodyFat = bodyFatInput / 100;

      const weightKg = unitSystem === 'imperial' ? weightInput * 0.453592 : weightInput;
      const heightCm = unitSystem === 'imperial' ? heightInput * 2.54 : heightInput;

      // Calculate BMR using Mifflin-St Jeor Equation (lean mass method)
      let BMR;
      if (gender === "Male") {
        BMR = 10 * weightKg + 6.25 * heightCm - 5 * age + 5;
      } else {
        BMR = 10 * weightKg + 6.25 * heightCm - 5 * age - 161;
      }

      // Calculate BMI
      const heightM = heightCm / 100;
      const BMI = weightKg / (heightM * heightM);

      // Lean body mass (kg)
      const leanMass = weightKg * (1 - bodyFat);

      // Goal weight
      let goalWeightKg = weightKg;
      if (goal === "Lose Fat") goalWeightKg = leanMass / (1 - 0.15);
      else if (goal === "Build Muscle") goalWeightKg = leanMass / (1 - 0.18);
      else goalWeightKg = weightKg;

      // Weight difference
      const weightDiff = weightKg - goalWeightKg;

      // Show results
      resultsDiv.innerHTML = `
        <p>BMR: ${BMR.toFixed(0)} kcal/day</p>
        <p>BMI: ${BMI.toFixed(2)}</p>
        <p>Lean Body Mass: ${leanMass.toFixed(2)} kg</p>
        <p>Goal Weight: ${goalWeightKg.toFixed(2)} kg</p>
        <p>Weight Difference: ${weightDiff.toFixed(2)} kg</p>
      `;

      // Set calorie goal based on BMR (example: BMR * 1.2 sedentary)
      calorieGoal = Math.round(BMR * 1.2);
      proteinGoal = 160; // You could also adjust protein here if you want

      // Switch views
      physiqueForm.style.display = 'none';
      dailyTracker.style.display = 'block';

      // Initialize date and load logs
      datePicker.value = new Date().toISOString().split('T')[0];
      updateProgress();
      loadLog();
    }

    // Date navigation
    function changeDate(days) {
      const currentDate = new Date(datePicker.value);
      currentDate.setDate(currentDate.getDate() + days);
      datePicker.value = currentDate.toISOString().split('T')[0];
      loadLog();
    }

    // Mock loading logs - here just reset consumed calories for simplicity
    function loadLog() {
      kcalConsumed = 0;
      proteinConsumed = 0;
      activityList.innerHTML = '';
      foodList.innerHTML = '';
      updateProgress();
      logContainer.innerHTML = `<p>Logs for ${datePicker.value} will appear here.</p>`;
    }

    // Update progress bars & stats
    function updateProgress() {
      const kcalPercent = Math.min((kcalConsumed / calorieGoal) * 100, 100);
      const proteinPercent = Math.min((proteinConsumed / proteinGoal) * 100, 100);

      progressFill.style.width = kcalPercent + '%';
      kcalStat.textContent = `${kcalConsumed} / ${calorieGoal} kcal (${Math.round(kcalPercent)}%)`;
      proteinStat.textContent = `${proteinConsumed}g / ${proteinGoal}g (${Math.round(proteinPercent)}%)`;
    }

    // Add activity (mock calories burned)
    function addActivity() {
      const type = document.getElementById('activityType').value;
      const duration = parseInt(document.getElementById('activityDuration').value);
      if (isNaN(duration) || duration <= 0) {
        alert('Please enter a valid activity duration.');
        return;
      }

      // Mock calories burned (simple multipliers)
      let caloriesBurned = 0;
      if (type === 'run') caloriesBurned = duration * 10;
      else if (type === 'lift') caloriesBurned = duration * 6;
      else if (type === 'walk') caloriesBurned = duration * 4;
      else if (type === 'stand') caloriesBurned = duration * 2;

      kcalConsumed -= caloriesBurned; // Subtract calories burned from consumed

      const li = document.createElement('li');
      li.textContent = `${type} - ${duration} min (-${caloriesBurned} kcal)`;
      activityList.appendChild(li);

      updateProgress();
    }

    // Add food (mock calories and protein)
    function addFood() {
      const food = document.getElementById('foodSearch').value.trim();
      const quantity = parseInt(document.getElementById('foodQuantity').value);

      if (!food || isNaN(quantity) || quantity <= 0) {
        alert('Please enter food name and valid quantity.');
        return;
      }

      // Mock calories and protein values (random for demo)
      const calories = quantity * 2;  // 2 kcal per unit
      const protein = quantity * 0.1; // 0.1g protein per unit

      kcalConsumed += calories;
      proteinConsumed += protein;

      const li = document.createElement('li');
      li.textContent = `${food} - ${quantity} units (+${calories} kcal, +${protein.toFixed(1)}g protein)`;
      foodList.appendChild(li);

      updateProgress();

      // Clear inputs
      document.getElementById('foodSearch').value = '';
      document.getElementById('foodQuantity').value = '';
    }

    // Drag and drop (basic placeholders)
    function allowDrop(ev) {
      ev.preventDefault();
    }

    function drop(ev) {
      ev.preventDefault();
      // This would be expanded to handle drag/drop food items to meals
      alert('Dropped in meal section!');
    }
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
    .then(() => console.log('Service Worker Registered'))
    .catch(err => console.log('Service Worker Registration Failed:', err));
  }
</script>

</body>
</html>
