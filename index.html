<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Workout Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 2rem;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button {
      font-size: 1rem;
      padding: 0.5rem;
      margin: 0.3rem 0.3rem 0.3rem 0;
    }
    .sets-inputs input {
      width: 60px;
    }
    .exercise {
      background: #f0f0f0;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
    }
    .menu {
      position: relative;
    }
    .menu-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }
    .menu-items {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      z-index: 10;
    }
    .menu:hover .menu-items {
      display: block;
    }
    .menu-items button {
      padding: 0.5rem;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
    }
    .saved-workouts {
      margin-top: 1rem;
    }
    .saved-workouts button {
      display: block;
      margin: 0.2rem 0;
      width: 100%;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Workout Tracker</h2>
  <label>Date: <input type="date" id="date"></label><br>
  <label>Workout Name: <input type="text" id="workoutName" placeholder="Push Day"></label><br>
  <hr>
  <h3>Add Exercise</h3>
  <input type="text" id="exercise" placeholder="Exercise Name">
  <input type="number" id="weight" placeholder="Weight (kg)">
  <div class="sets-inputs" id="sets"></div>
  <button id="addSet">+ Add Set</button>
  <button id="saveExercise">Save Exercise</button>
  <hr>
  <button id="saveWorkout">ðŸ’¾ Save Workout</button>
  <h3>Exercises</h3>
  <div id="log"></div>
  <div class="saved-workouts" id="savedWorkouts"></div>
</div>
<script>
  const dateEl = document.getElementById('date');
  const workoutNameEl = document.getElementById('workoutName');
  const exerciseEl = document.getElementById('exercise');
  const weightEl = document.getElementById('weight');
  const setsContainer = document.getElementById('sets');
  const addSetBtn = document.getElementById('addSet');
  const saveExerciseBtn = document.getElementById('saveExercise');
  const saveWorkoutBtn = document.getElementById('saveWorkout');
  const logEl = document.getElementById('log');
  const savedWorkoutsEl = document.getElementById('savedWorkouts');

  let sets = [""];
  let editingIndex = -1;

  const getKey = (date) => `workout_${date}`;

  const loadWorkout = (date = dateEl.value) => {
    const raw = localStorage.getItem(getKey(date));
    const data = raw ? JSON.parse(raw) : { name: '', exercises: [] };
    return data;
  };

  const saveWorkoutData = (data, date = dateEl.value) => {
    localStorage.setItem(getKey(date), JSON.stringify(data));
    let saved = JSON.parse(localStorage.getItem('savedWorkoutDates') || '[]');
    if (!saved.includes(date)) {
      saved.push(date);
      localStorage.setItem('savedWorkoutDates', JSON.stringify(saved));
    }
  };

  const renderSets = () => {
    setsContainer.innerHTML = '';
    sets.forEach((val, idx) => {
      const input = document.createElement('input');
      input.type = 'number';
      input.value = val;
      input.placeholder = `Set ${idx + 1}`;
      input.oninput = () => sets[idx] = input.value;
      setsContainer.appendChild(input);
    });
  };

  const renderLog = () => {
    logEl.innerHTML = '';
    if (!dateEl.value) return;
    const data = loadWorkout();
    data.exercises.forEach((ex, i) => {
      const div = document.createElement('div');
      div.className = 'exercise';
      const info = document.createElement('div');
      info.textContent = `${ex.name} - ${ex.weight}kg - ${ex.sets.join(' / ')}`;
      const menu = document.createElement('div');
      menu.className = 'menu';
      const btn = document.createElement('button');
      btn.textContent = 'â‹®';
      btn.className = 'menu-btn';
      const menuItems = document.createElement('div');
      menuItems.className = 'menu-items';
      const editBtn = document.createElement('button');
      editBtn.textContent = 'Edit';
      editBtn.onclick = () => {
        exerciseEl.value = ex.name;
        weightEl.value = ex.weight;
        sets = [...ex.sets];
        editingIndex = i;
        renderSets();
      };
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.onclick = () => {
        const data = loadWorkout();
        data.exercises.splice(i, 1);
        saveWorkoutData(data);
        renderLog();
      };
      menuItems.append(editBtn, deleteBtn);
      menu.append(btn, menuItems);
      div.append(info, menu);
      logEl.appendChild(div);
    });
  };

  const renderSavedWorkouts = () => {
    const saved = JSON.parse(localStorage.getItem('savedWorkoutDates') || '[]');
    savedWorkoutsEl.innerHTML = '<h3>Saved Workouts</h3>';
    saved.forEach(date => {
      const btn = document.createElement('button');
      const data = loadWorkout(date);
      btn.textContent = `${date} - ${data.name}`;
      btn.onclick = () => {
        dateEl.value = date;
        workoutNameEl.value = data.name;
        sets = [""];
        editingIndex = -1;
        renderSets();
        renderLog();
      };
      savedWorkoutsEl.appendChild(btn);
    });
  };

  dateEl.addEventListener('change', () => {
    if (dateEl.value) {
      localStorage.setItem('lastDate', dateEl.value);
      sets = [""];
      editingIndex = -1;
      renderSets();
      renderLog();
    }
  });

  addSetBtn.onclick = () => {
    if (sets.length < 5) {
      sets.push("");
      renderSets();
    }
  };

  saveExerciseBtn.onclick = () => {
    const name = exerciseEl.value.trim();
    const weight = parseFloat(weightEl.value);
    const reps = sets.map(r => parseInt(r)).filter(x => !isNaN(x));

    if (!dateEl.value || !name || isNaN(weight) || reps.length === 0) {
      alert("Fill in all fields correctly.");
      return;
    }

    const data = loadWorkout();
    const newEx = { name, weight, sets: reps };
    if (editingIndex > -1) {
      data.exercises[editingIndex] = newEx;
      editingIndex = -1;
    } else {
      if (data.exercises.length >= 10) {
        alert("Max 10 exercises per workout.");
        return;
      }
      data.exercises.push(newEx);
    }
    saveWorkoutData(data);
    exerciseEl.value = '';
    weightEl.value = '';
    sets = [""];
    renderSets();
    renderLog();
  };

  saveWorkoutBtn.onclick = () => {
    if (!dateEl.value) {
      alert("Please select a date.");
      return;
    }
    const data = loadWorkout();
    data.name = workoutNameEl.value.trim();
    saveWorkoutData(data);
    renderSavedWorkouts();
    workoutNameEl.value = '';
    exerciseEl.value = '';
    weightEl.value = '';
    sets = [""];
    editingIndex = -1;
    renderSets();
    renderLog();
  };

  window.addEventListener('DOMContentLoaded', () => {
    const lastDate = localStorage.getItem('lastDate');
    if (lastDate) {
      dateEl.value = lastDate;
    }
    renderSets();
    renderSavedWorkouts();
    renderLog();
  });

  // Init
  sets = [""];
  renderSets();
</script>
</body>
</html>

