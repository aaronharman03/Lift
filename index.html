<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workout Tracker</title>
<style>
  /* --- Shared styles --- */
  body {
    font-family: sans-serif;
    padding: 20px;
    max-width: 800px;
    margin: auto;
    background: #fff;
  }
  h1 {
    margin-bottom: 20px;
    text-align: center;
  }
  button {
    cursor: pointer;
  }
  .btn-back {
    background-color: #6c757d;
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 5px;
  }
  .btn-back:hover {
    opacity: 0.9;
  }

  /* --- Main (Days) page --- */
  #mainView {
    display: none;
  }
  #daysList {
    list-style: none;
    padding: 0;
    font-size: 18px;
    margin-bottom: 30px;
  }
  #daysList li {
    margin-bottom: 10px;
  }
  #daysList a {
    color: #007bff;
    text-decoration: none;
  }
  #daysList a:hover {
    text-decoration: underline;
  }
  #addDayBtn {
    padding: 10px 20px;
    font-size: 18px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    display: block;
    margin: 0 auto 30px;
  }
  #addDayBtn:hover {
    opacity: 0.9;
  }

  /* --- Workout Day page --- */
  #dayView {
    display: none;
  }
  header.day-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  #exercisesList {
    font-size: 18px;
    line-height: 1.6;
    margin-bottom: 20px;
  }
  .exercise-line {
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    background: #f7f7f7;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }
  .exercise-text {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1;
  }
  #viewGraphBtn {
    background-color: #28a745;
    color: white;
    padding: 8px 14px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
  }
  #viewGraphBtn:hover {
    opacity: 0.9;
  }
  #addExerciseBtn {
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    display: block;
    margin: 0 auto 30px;
  }
  #addExerciseBtn:hover {
    opacity: 0.9;
  }

  /* --- Modal styles --- */
  #modalOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.4);
    display: none;
    z-index: 1000;
  }
  #modal {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 320px;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.25);
    transform: translate(-50%, -50%);
    z-index: 1001;
    display: none;
  }
  #modal h2 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 24px;
    text-align: center;
  }
  #modal input, #modal select {
    width: 100%;
    padding: 8px 10px;
    margin-bottom: 12px;
    font-size: 16px;
    box-sizing: border-box;
  }
  #repsInputs input {
    width: 60px;
    margin-right: 6px;
  }
  #modalButtons {
    text-align: center;
    margin-bottom: 10px;
  }
  #modalButtons button {
    padding: 8px 16px;
    margin: 0 8px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
  }
  #saveBtn {
    background-color: #007bff;
    color: white;
  }
  #saveBtn:hover {
    opacity: 0.9;
  }
  #cancelBtn {
    background-color: #6c757d;
    color: white;
  }
  #cancelBtn:hover {
    opacity: 0.9;
  }
  #deleteBtn {
    width: 100%;
    padding: 8px;
    font-size: 16px;
    background-color: #dc3545;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  #deleteBtn:hover {
    opacity: 0.9;
  }
  #weight-container {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
  }
  #weight {
    flex: 1;
  }
  #weightUnitBtn {
    margin-left: 8px;
    padding: 6px 12px;
    cursor: pointer;
    user-select: none;
    border: 1px solid #ccc;
    border-radius: 4px;
    background: #f0f0f0;
    font-weight: bold;
  }

  /* --- Progress Graph page --- */
  #graphView {
    display: none;
  }
  #exerciseSelect {
    font-size: 16px;
    margin: 20px auto;
    display: block;
    padding: 8px;
  }
  canvas {
    margin-top: 20px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<!-- Main View: Workout Days -->
<div id="mainView">
  <h1>Workout Days</h1>
  <ul id="daysList"></ul>
  <button id="addDayBtn">Add Day</button>
</div>

<!-- Workout Day View -->
<div id="dayView" role="main" aria-label="Workout Day">
  <header class="day-header">
    <button class="btn-back" id="backToDaysBtn">← Back to Days</button>
    <button id="viewGraphBtn">View Progress Graph</button>
  </header>
  <h1 id="dayTitle">Workout Day</h1>
  <div id="exercisesList"></div>
  <button id="addExerciseBtn">Add Exercise</button>
</div>

<!-- Modal for add/edit exercise -->
<div id="modalOverlay"></div>
<div id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <h2 id="modalTitle">Add Exercise</h2>
  <form id="exerciseForm">
    <input type="text" id="exerciseName" placeholder="Exercise Name" required autocomplete="off" />
    <div id="weight-container">
      <input type="number" id="weight" placeholder="Weight" min="0" step="0.25" autocomplete="off" />
      <button type="button" id="weightUnitBtn">kg</button>
    </div>
    <select id="numSets" required>
      <option value="">Select Sets</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
    <div id="repsInputs" style="margin-bottom: 15px;"></div>
    <div id="modalButtons">
      <button type="submit" id="saveBtn">Save</button>
      <button type="button" id="cancelBtn">Cancel</button>
    </div>
    <button type="button" id="deleteBtn" style="display:none;">Delete</button>
  </form>
</div>

<!-- Progress Graph View -->
<div id="graphView" role="main" aria-label="Exercise Progress Graph">
  <button class="btn-back" id="backFromGraphBtn">← Back</button>
  <h1>Exercise Progress</h1>
  <select id="exerciseSelect">
    <option value="">Select Exercise</option>
  </select>
  <canvas id="progressChart" height="300"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // --- Variables and element references ---
  const mainView = document.getElementById('mainView');
  const dayView = document.getElementById('dayView');
  const graphView = document.getElementById('graphView');

  // Main view elements
  const daysList = document.getElementById('daysList');
  const addDayBtn = document.getElementById('addDayBtn');

  // Day view elements
  const backToDaysBtn = document.getElementById('backToDaysBtn');
  const dayTitle = document.getElementById('dayTitle');
  const exercisesListEl = document.getElementById('exercisesList');
  const addExerciseBtn = document.getElementById('addExerciseBtn');
  const viewGraphBtn = document.getElementById('viewGraphBtn');

  // Modal elements
  const modal = document.getElementById('modal');
  const modalOverlay = document.getElementById('modalOverlay');
  const exerciseForm = document.getElementById('exerciseForm');
  const exerciseNameInput = document.getElementById('exerciseName');
  const weightInput = document.getElementById('weight');
  const weightUnitBtn = document.getElementById('weightUnitBtn');
  const numSetsSelect = document.getElementById('numSets');
  const repsInputsDiv = document.getElementById('repsInputs');
  const saveBtn = document.getElementById('saveBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const modalTitle = document.getElementById('modalTitle');

  // Graph view elements
  const backFromGraphBtn = document.getElementById('backFromGraphBtn');
  const exerciseSelect = document.getElementById('exerciseSelect');
  const ctx = document.getElementById('progressChart').getContext('2d');
  let chart;

  // --- State variables ---
  let currentView = 'main'; // main | day | graph
  let currentDay = null;
  let exercises = [];
  let editingIndex = null;
  let currentWeightUnit = 'kg';

  // --- Helpers ---

  // Show only the chosen view
  function showView(view) {
    currentView = view;
    mainView.style.display = view === 'main' ? 'block' : 'none';
    dayView.style.display = view === 'day' ? 'block' : 'none';
    graphView.style.display = view === 'graph' ? 'block' : 'none';
  }

  // Load and render workout days from localStorage
  function loadDays() {
    let days = JSON.parse(localStorage.getItem('workout_days') || '[]');
    if (!Array.isArray(days)) days = [];
    daysList.innerHTML = '';
    if (days.length === 0) {
      daysList.textContent = 'No workout days yet.';
      return;
    }
    days.forEach(dayNum => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#';
      a.textContent = `Workout Day ${dayNum}`;
      a.addEventListener('click', e => {
        e.preventDefault();
        openDay(dayNum);
      });
      li.appendChild(a);
      daysList.appendChild(li);
    });
  }

  // Add new day, always next integer
  addDayBtn.addEventListener('click', () => {
    let days = JSON.parse(localStorage.getItem('workout_days') || '[]');
    if (!Array.isArray(days)) days = [];
    let nextDay = 1;
    if (days.length > 0) nextDay = Math.max(...days) + 1;
    days.push(nextDay);
    days.sort((a,b)=>a-b);
    localStorage.setItem('workout_days', JSON.stringify(days));
    loadDays();
  });

  // Open specific workout day view
  function openDay(dayNum) {
    currentDay = dayNum;
    dayTitle.textContent = `Workout Day ${dayNum}`;
    // Load exercises
    exercises = JSON.parse(localStorage.getItem(`workout_day_${dayNum}`)) || [];
    renderExercises();
    showView('day');
  }

  // Render exercises list for current day
  function renderExercises() {
    if (exercises.length === 0) {
      exercisesListEl.textContent = 'No exercises yet.';
      return;
    }
    exercisesListEl.innerHTML = '';
    exercises.forEach((ex, i) => {
      const div = document.createElement('div');
      div.className = 'exercise-line';
      const text = document.createElement('div');
      text.className = 'exercise-text';
      text.textContent = `${ex.name}${ex.weight != null ? ' — ' + ex.weight + (ex.unit || 'kg') : ''} — ${ex.sets} set${ex.sets > 1 ? 's' : ''} — Reps: ${ex.reps.join(', ')}`;
      div.appendChild(text);

      // Click to edit
      div.addEventListener('click', () => openModal(i));
      exercisesListEl.appendChild(div);
    });
  }

  // Open modal for add/edit exercise
  function openModal(index = null) {
    editingIndex = index;
    if (index === null) {
      // Add mode
      modalTitle.textContent = 'Add Exercise';
      exerciseNameInput.value = '';
      weightInput.value = '';
      currentWeightUnit = 'kg';
      weightUnitBtn.textContent = currentWeightUnit;
      numSetsSelect.value = '';
      repsInputsDiv.innerHTML = '';
      deleteBtn.style.display = 'none';
    } else {
      // Edit mode
      modalTitle.textContent = 'Edit Exercise';
      const ex = exercises[index];
      exerciseNameInput.value = ex.name || '';
      weightInput.value = ex.weight != null ? ex.weight : '';
      currentWeightUnit = ex.unit || 'kg';
      weightUnitBtn.textContent = currentWeightUnit;
      numSetsSelect.value = ex.sets || '';
      generateRepsInputs(ex.sets, ex.reps);
      deleteBtn.style.display = 'block';
    }
    modal.style.display = 'block';
    modalOverlay.style.display = 'block';
    exerciseNameInput.focus();
  }

  // Close modal
  function closeModal() {
    modal.style.display = 'none';
    modalOverlay.style.display = 'none';
    editingIndex = null;
  }

  // Generate reps inputs based on sets count and prefill reps array if given
  function generateRepsInputs(sets, reps = []) {
    repsInputsDiv.innerHTML = '';
    sets = parseInt(sets);
    if (isNaN(sets) || sets < 1) return;
    for (let i = 0; i < sets; i++) {
      const input = document.createElement('input');
      input.type = 'number';
      input.min = 1;
      input.placeholder = `Reps for set ${i + 1}`;
      input.value = reps[i] || '';
      input.required = true;
      input.autocomplete = 'off';
      repsInputsDiv.appendChild(input);
    }
  }

  // Update reps inputs on sets change
  numSetsSelect.addEventListener('change', () => {
    generateRepsInputs(numSetsSelect.value);
  });

  // Weight unit toggle button
  weightUnitBtn.addEventListener('click', () => {
    currentWeightUnit = currentWeightUnit === 'kg' ? 'lbs' : 'kg';
    weightUnitBtn.textContent = currentWeightUnit;
  });

  // Save exercise from modal form
  exerciseForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = exerciseNameInput.value.trim();
    if (!name) {
      alert('Exercise name is required');
      return;
    }
    const weightVal = weightInput.value;
    const weight = weightVal === '' ? null : parseFloat(weightVal);
    const unit = currentWeightUnit;
    const sets = parseInt(numSetsSelect.value);
    if (isNaN(sets) || sets < 1) {
      alert('Please select number of sets');
      return;
    }
    const reps = [];
    const repsInputs = repsInputsDiv.querySelectorAll('input');
    for (const input of repsInputs) {
      const v = parseInt(input.value);
      if (isNaN(v) || v < 1) {
        alert('Please enter valid reps for all sets');
        return;
      }
      reps.push(v);
    }
    if (editingIndex === null) {
      // Add new
      exercises.push({name, weight, unit, sets, reps});
    } else {
      // Edit existing
      exercises[editingIndex] = {name, weight, unit, sets, reps};
    }
    localStorage.setItem(`workout_day_${currentDay}`, JSON.stringify(exercises));
    renderExercises();
    closeModal();
  });

  // Cancel modal
  cancelBtn.addEventListener('click', closeModal);
  modalOverlay.addEventListener('click', closeModal);

  // Delete exercise
  deleteBtn.addEventListener('click', () => {
    if (editingIndex !== null) {
      if (confirm('Delete this exercise?')) {
        exercises.splice(editingIndex, 1);
        localStorage.setItem(`workout_day_${currentDay}`, JSON.stringify(exercises));
        renderExercises();
        closeModal();
      }
    }
  });

  // Navigation buttons
  backToDaysBtn.addEventListener('click', () => {
    currentDay = null;
    showView('main');
    loadDays();
  });

  addExerciseBtn.addEventListener('click', () => {
    openModal();
  });

  // --- Graph Page Logic ---
  backFromGraphBtn.addEventListener('click', () => {
    showView('day');
  });

  viewGraphBtn.addEventListener('click', () => {
    // Load exercises from current day into select options
    const logs = JSON.parse(localStorage.getItem(`workout_day_${currentDay}`) || '[]');
    exerciseSelect.innerHTML = '<option value="">Select Exercise</option>';
    const names = [...new Set(logs.map(l => l.name))];
    names.forEach(name => {
      const opt = document.createElement('option');
      opt.value = name;
      opt.textContent = name;
      exerciseSelect.appendChild(opt);
    });
    if(names.length === 0) {
      exerciseSelect.innerHTML = '<option value="">No exercises available</option>';
    }
    // Clear chart if any
    if(chart) {
      chart.destroy();
      chart = null;
    }
    showView('graph');
  });

  exerciseSelect.addEventListener('change', () => {
    const selected = exerciseSelect.value;
    if (!selected) {
      if(chart) {
        chart.destroy();
        chart = null;
      }
      return;
    }
    // Get all logs from all days to show progress over time
    // We'll gather logs from all days to match the original graph page behavior.
    const allDays = JSON.parse(localStorage.getItem('workout_days') || '[]');
    let allLogs = [];
    allDays.forEach(dayNum => {
      const logs = JSON.parse(localStorage.getItem(`workout_day_${dayNum}`) || '[]');
      // logs might not have date info - we will fabricate a date based on day number for demo
      // Because original logs had no date, we add date as dayNum for demonstration:
      // But your original code used date property - let's adapt:
      // So let's add date as YYYY-MM-DD based on dayNum to allow sorting
      // For now, assume date = today minus (maxDay - dayNum) days
      // This simulates timeline progression.
      const baseDate = new Date();
      allLogs = allLogs.concat(logs.map(log => {
        return {
          ...log,
          date: generateDateForDay(dayNum),
          dayNum
        };
      }));
    });
    // Filter logs for selected exercise and those with weight
    const data = allLogs
      .filter(log => log.name === selected && log.weight != null)
      .sort((a,b) => new Date(a.date) - new Date(b.date));

    const labels = data.map(log => log.date);
    const weights = data.map(log => log.weight);

    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: `${selected} Weight`,
          data: weights,
          borderColor: '#007bff',
          backgroundColor: 'rgba(0, 123, 255, 0.2)',
          tension: 0.3,
          fill: true
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: false,
            title: {
              display: true,
              text: 'Weight'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Date'
            }
          }
        }
      }
    });
  });

  // Helper to generate pseudo-date string based on day number (for graph)
  function generateDateForDay(dayNum) {
    // Just create date: current day minus (maxDay - dayNum) days
    // So day 1 is earliest date
    const days = JSON.parse(localStorage.getItem('workout_days') || '[]');
    if (!days.length) return new Date().toISOString().slice(0,10);
    const maxDay = Math.max(...days);
    const diff = maxDay - dayNum;
    const d = new Date();
    d.setDate(d.getDate() - diff);
    return d.toISOString().slice(0,10);
  }

  // --- Initial load ---
  loadDays();
  showView('main');
</script>
</body>
</html>










